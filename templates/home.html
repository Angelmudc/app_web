{% extends 'base.html' %}

{% block title %}Doméstica del Cibao A&D – Inicio{% endblock %}

{% block hero %}
  <section class="hero-section">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center jumbotron text-center"
           style="background-color: #4a69bd; border-radius: 10px; color: #fff; padding: 40px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);">
        <img src="{{ url_for('static', filename='logo_nuevo.png') }}"
             alt="Doméstica del Cibao A&D"
             style="max-width: 600px; border-radius: 10px; transition: transform 0.3s;">
        <div>
          <p class="mt-3" style="font-size: 1.1rem;">
            Gestión profesional y confiable de empleadas domésticas.
          </p>
        </div>
        <div>
          {# ---------- MEJORA: botón de ingreso con fallback ---------- #}
          {% set admin_login_url = url_for_safe('admin.login') %}
          {% set fallback_login_url = url_for_safe('login') %}
          {% if admin_login_url %}
            <a href="{{ admin_login_url }}" class="btn btn-light" style="font-weight: bold;">
              🔑 Ingresar Administrador
            </a>
          {% elif fallback_login_url %}
            <a href="{{ fallback_login_url }}" class="btn btn-light" style="font-weight: bold;">
              🔑 Ingresar
            </a>
          {% endif %}
          {# ----------------------------------------------------------- #}
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block content %}
  <div class="py-4">
    <h1 class="mb-4 text-center">📋 Panel Principal</h1>

    <!-- Sección: Gestión de Candidatas -->
    <div class="mb-5">
      <h2 class="h4">Gestión de Candidatas</h2>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mt-2">

        <!-- Buscar / Editar -->
        {% set buscar_url = url_for_safe('buscar_candidata') %}
        {% if buscar_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-search fa-2x mb-3"></i>
              <h5 class="card-title">🔍 Buscar / Editar</h5>
              <p class="card-text flex-grow-1">
                Busca cualquier candidata por nombre o cédula y edita sus datos inline.
              </p>
              <a href="{{ buscar_url }}" class="btn btn-primary mt-auto">Ir a Buscar/Editar</a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Inscripción -->
        {% set insc_url = url_for_safe('inscripcion') %}
        {% if insc_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-user-plus fa-2x mb-3"></i>
              <h5 class="card-title">📝 Inscripción</h5>
              <p class="card-text flex-grow-1">
                Registra la inscripción de candidatas, asigna código, monto y fecha.
              </p>
              <a href="{{ insc_url }}" class="btn btn-primary mt-auto">Ir a Inscripción</a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Porciento -->
        {% set porc_url = url_for_safe('porciento') %}
        {% if porc_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-percentage fa-2x mb-3"></i>
              <h5 class="card-title">💲 Porciento</h5>
              <p class="card-text flex-grow-1">
                Calcula los porcentajes pendientes de las candidatas y marca estado.
              </p>
              <a href="{{ porc_url }}" class="btn btn-primary mt-auto">Ir a Porcentaje</a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Pagos -->
        {% set pagos_url = url_for_safe('pagos') %}
        {% if pagos_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-file-invoice-dollar fa-2x mb-3"></i>
              <h5 class="card-title">💳 Pagos</h5>
              <p class="card-text flex-grow-1">
                Gestiona pagos pendientes, registra abonos y calificaciones.
              </p>
              <a href="{{ pagos_url }}" class="btn btn-primary mt-auto">Ir a Pagos</a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Filtrar General -->
        {% set filtrar_url = url_for_safe('filtrar') %}
        {% if filtrar_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-filter fa-2x mb-3"></i>
              <h5 class="card-title">🔎 Filtrar Candidatas</h5>
              <p class="card-text flex-grow-1">
                Filtra por ciudad, rutas, modalidad, experiencia y áreas.
              </p>
              <a href="{{ filtrar_url }}" class="btn btn-primary mt-auto">Ir a Filtrar</a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Estadísticas de Procesos -->
        {% set dash_proc_url = url_for_safe('dashboard_procesos') %}
        {% if dash_proc_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-chart-pie fa-2x mb-3"></i>
              <h5 class="card-title">📊 Dashboard Procesos</h5>
              <p class="card-text flex-grow-1">
                Totales, entradas diarias y desglose por estado.
              </p>
              <a href="{{ dash_proc_url }}" class="btn btn-primary mt-auto">Ver Dashboard</a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Finalizar Proceso -->
        {% set finproc_url = url_for_safe('finalizar_proceso') %}
        {% if finproc_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-clipboard-check fa-2x mb-3"></i>
              <h5 class="card-title">✅ Finalizar Proceso</h5>
              <p class="card-text flex-grow-1">
                Completa el proceso de selección: sube fotos, asigna grupos y actualiza estado.
              </p>
              <a href="{{ finproc_url }}" class="btn btn-primary">Ir a Finalizar</a>

              {# --------- NUEVO: accesos rápidos para organizar el flujo --------- #}
              <div class="mt-3">
                {% set fin_buscar_url = url_for_safe('finalizar_proceso_buscar') %}
                {% set ver_perfil_url = url_for_safe('candidata_ver_perfil') %}
                <div class="d-grid gap-2">
                  {% if fin_buscar_url %}
                    <a href="{{ fin_buscar_url }}" class="btn btn-outline-secondary btn-sm">🔎 Buscar candidata para finalizar</a>
                  {% endif %}
                </div>
              </div>
              {# ------------------------------------------------------------------- #}
            </div>
          </div>
        </div>
        {% endif %}

      </div>
    </div>

    <!-- NUEVA Sección: Solicitudes (Secretarias) -->
    <div class="mb-5">
      <h2 class="h4">🧾 Solicitudes</h2>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mt-2">

        <!-- Publicar hoy: marca al copiar y oculta hasta 1:00 AM -->
        {% set copiar_hoy_url = url_for_safe('secretarias_copiar_solicitudes') %}
        {% if copiar_hoy_url %}
        <div class="col">
          <div class="card h-100 shadow-sm border-success">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-bullhorn fa-2x mb-3"></i>
              <h5 class="card-title">📢 Publicar hoy</h5>
              <p class="card-text flex-grow-1">
                Lista de solicitudes activas del ciclo. Al <strong>copiar</strong> se marcan y se ocultan hasta la <strong>1:00 AM</strong> del siguiente día.
              </p>
              <a href="{{ copiar_hoy_url }}" class="btn btn-success mt-auto">Ir a Publicar</a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Buscar: copiar SIN marcar -->
        {% set buscar_sols_url = url_for_safe('secretarias_buscar_solicitudes') %}
        {% if buscar_sols_url %}
        <div class="col">
          <div class="card h-100 shadow-sm border-primary">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-search-plus fa-2x mb-3"></i>
              <h5 class="card-title">🔎 Buscar solicitudes</h5>
              <p class="card-text flex-grow-1">
                Búsqueda con filtros y detalle expandible. El botón <strong>Copiar</strong> no marca ni oculta.
              </p>
              <a href="{{ buscar_sols_url }}" class="btn btn-primary mt-auto">Ir a Buscar</a>
            </div>
          </div>
        </div>
        {% endif %}

      </div>
    </div>

    <!-- Sección: Reportes -->
    <div class="mb-5">
      <h2 class="h4">📊 Reportes</h2>
      <div class="row row-cols-1 row-cols-md-2 g-4 mt-2">
        <!-- Reporte de Inscripciones -->
        {% set rep_insc_url = url_for_safe('reporte_inscripciones') %}
        {% if rep_insc_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-list-alt fa-2x mb-3"></i>
              <h5 class="card-title">📈 Reporte Inscripciones</h5>
              <p class="card-text flex-grow-1">
                Filtra inscripciones por mes/año. Descarga en Excel o visualiza online.
              </p>
              <a href="{{ rep_insc_url }}" class="btn btn-secondary mt-auto">Ver Reporte Inscripciones</a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Reporte de Pagos -->
        {% set rep_pagos_url = url_for_safe('reporte_pagos') %}
        {% if rep_pagos_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-chart-bar fa-2x mb-3"></i>
              <h5 class="card-title">📄 Reporte Pagos</h5>
              <p class="card-text flex-grow-1">
                Genera PDF con los pagos pendientes de todas las candidatas.
              </p>
              <a href="{{ rep_pagos_url }}" class="btn btn-secondary mt-auto">Ver Reporte Pagos</a>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- NUEVA Sección: Sitio Público -->
    <div class="mb-5">
      <h2 class="h4">🌐 Sitio Público</h2>
      <div class="row row-cols-1 row-cols-md-2 g-4 mt-2">
        {% set registro_publico_url = url_for_safe('registro_publico') %}
        {% if registro_publico_url %}
        <div class="col">
          <div class="card h-100 shadow-sm border-info">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-user-edit fa-2x mb-3"></i>
              <h5 class="card-title">🗳️ Registro Público</h5>
              <p class="card-text flex-grow-1">
                Formulario público de registro/solicitud para clientes o candidatas (según tu implementación).
              </p>
              <a href="{{ registro_publico_url }}" class="btn btn-info mt-auto">Ir a Registro Público</a>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Sección: Documentos -->
    <div class="mb-5">
      <h2 class="h4">📁 Documentos</h2>
      <div class="row row-cols-1 row-cols-md-2 g-4 mt-2">
        <!-- Subir Fotos -->
        {% set subir_fotos_url = url_for_safe('subir_fotos.subir_fotos') %}
        {% if subir_fotos_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-folder-plus fa-2x mb-3"></i>
              <h5 class="card-title">📤 Subir Fotos</h5>
              <p class="card-text flex-grow-1">
                Sube imágenes de candidatas y guarda en la base de datos.
              </p>
              <a href="{{ subir_fotos_url }}" class="btn btn-info mt-auto">Ir a Subir Fotos</a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Gestionar Archivos -->
        {% set gest_arch_url = url_for_safe('gestionar_archivos') %}
        {% if gest_arch_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-folder-open fa-2x mb-3"></i>
              <h5 class="card-title">📥 Gestionar Archivos</h5>
              <p class="card-text flex-grow-1">
                Descarga o visualiza documentos y entrevistas de candidatas.
              </p>
              <a href="{{ gest_arch_url }}" class="btn btn-info mt-auto">Ir a Gestionar Archivos</a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Referencias -->
        {% set ref_url = url_for_safe('referencias') %}
        {% if ref_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-address-book fa-2x mb-3"></i>
              <h5 class="card-title">🗂️ Referencias</h5>
              <p class="card-text flex-grow-1">
                Busca y edita las referencias laborales y familiares de una candidata.
              </p>
              <a href="{{ ref_url }}" class="btn btn-info mt-auto">Ir a Referencias</a>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Entrevista -->
        {% set entrevista_url = url_for_safe('entrevista') %}
        {% if entrevista_url %}
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <i class="fas fa-pencil-alt fa-2x mb-3"></i>
              <h5 class="card-title">📝 Entrevista</h5>
              <p class="card-text flex-grow-1">
                Realiza y guarda entrevistas dinámicas directamente en la base de datos.
              </p>
              <a href="{{ entrevista_url }}" class="btn btn-info mt-auto">Ir a Entrevista</a>
            </div>
          </div>
        </div>
        {% endif %}

      </div>
    </div>

  </div>
{% endblock %}
