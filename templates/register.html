{# templates/registro_publico.html (o el nombre que ya usas para este view) #}
{% extends 'base.html' %}
{% block title %}Registro de Candidata{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Encabezado -->
  <section class="hero-section">
    <h1 class="h3 mb-1">üìù Registro de Candidata</h1>
    <p class="text-muted mb-0">Completa los campos marcados con <span class="text-danger">*</span>. Tardas menos de 3 minutos.</p>
  </section>

  <!-- Flashes (adem√°s de los toasts globales de base.html) -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mt-3">
        {% for cat, msg in messages %}
          <div class="alert alert-{{ 'danger' if cat in ['danger','error'] else 'warning' if cat=='warning' else 'success' }} alert-dismissible fade show" role="alert">
            {{ msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="post" action="{{ url_for('register') }}" class="mt-3" novalidate>
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <!-- Paso 1: Datos personales -->
    <div class="card mb-3">
      <div class="card-header d-flex align-items-center gap-2">
        <i class="fa-solid fa-id-card-clip"></i>
        <strong>Datos personales</strong>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <!-- Nombre completo -->
          <div class="col-md-6">
            <label for="nombre_completo" class="form-label">Nombre completo <span class="text-danger">*</span></label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-user"></i></span>
              <input type="text" class="form-control" id="nombre_completo" name="nombre_completo" required autocomplete="name" placeholder="Ej: Mar√≠a L√≥pez">
            </div>
            <div class="form-text">Como aparece en tu c√©dula.</div>
          </div>

          <!-- Edad -->
          <div class="col-md-3">
            <label for="edad" class="form-label">Edad <span class="text-danger">*</span></label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-hashtag"></i></span>
              <input type="text" class="form-control" id="edad" name="edad" required inputmode="numeric" placeholder="Ej: 28">
            </div>
          </div>

          <!-- C√©dula -->
          <div class="col-md-3">
            <label for="cedula" class="form-label">C√©dula <span class="text-danger">*</span></label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-regular fa-address-card"></i></span>
              <input type="text" class="form-control" id="cedula" name="cedula" required inputmode="numeric" maxlength="13" placeholder="000-0000000-0">
            </div>
            <div class="form-text">Ingresa tu c√©dula (11 d√≠gitos). Se formatea autom√°ticamente.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Paso 2: Contacto y ubicaci√≥n -->
    <div class="card mb-3">
      <div class="card-header d-flex align-items-center gap-2">
        <i class="fa-solid fa-location-dot"></i>
        <strong>Contacto y ubicaci√≥n</strong>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <!-- Tel√©fono -->
          <div class="col-md-4">
            <label for="numero_telefono" class="form-label">N√∫mero de tel√©fono <span class="text-danger">*</span></label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-mobile-screen-button"></i></span>
              <input type="text" class="form-control" id="numero_telefono" name="numero_telefono" required inputmode="tel" placeholder="809-000-0000">
            </div>
            <div class="form-text">Si no es tu n√∫mero personal, ind√≠calo.</div>
          </div>

          <!-- Direcci√≥n -->
          <div class="col-md-8">
            <label for="direccion_completa" class="form-label">Direcci√≥n completa <span class="text-danger">*</span></label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-map"></i></span>
              <textarea class="form-control" id="direccion_completa" name="direccion_completa" rows="2" required placeholder="Ciudad, sector, calle y n√∫mero"></textarea>
            </div>
          </div>
        </div>

        <div class="row g-3 mt-1">
          <!-- Rutas -->
          <div class="col-md-6">
            <label for="rutas_cercanas" class="form-label">Rutas cercanas <span class="text-danger">*</span></label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-bus"></i></span>
              <input type="text" class="form-control" id="rutas_cercanas" name="rutas_cercanas" required placeholder="Ej: Ruta A, Av. Principal‚Ä¶">
            </div>
            <div class="form-text">Escribe las rutas de transporte que pasan por tu zona.</div>
          </div>

          <!-- Modalidad -->
          <div class="col-md-6">
            <label class="form-label">Modalidad de trabajo preferida <span class="text-danger">*</span></label>
            <div class="d-flex gap-3 flex-wrap">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="modalidad_trabajo_preferida" id="modalidad_salida" value="Salida diaria" required>
                <label class="form-check-label" for="modalidad_salida">Salida diaria</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="modalidad_trabajo_preferida" id="modalidad_dormida" value="Dormida">
                <label class="form-check-label" for="modalidad_dormida">Dormida</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Paso 3: Experiencia -->
    <div class="card mb-3">
      <div class="card-header d-flex align-items-center gap-2">
        <i class="fa-solid fa-briefcase"></i>
        <strong>Experiencia</strong>
      </div>
      <div class="card-body">
        <!-- Empleo anterior -->
        <div class="mb-3">
          <label for="empleo_anterior" class="form-label">¬øQu√© hac√≠as en tu empleo anterior? <span class="text-danger">*</span></label>
          <div class="input-group">
            <span class="input-group-text"><i class="fa-solid fa-building-user"></i></span>
            <textarea class="form-control" id="empleo_anterior" name="empleo_anterior" rows="2" required placeholder="Ej: limpieza general, cocinar, cuidado de ni√±os‚Ä¶"></textarea>
          </div>
        </div>

        <div class="row g-3">
          <!-- A√±os de experiencia -->
          <div class="col-md-6">
            <label class="form-label">¬øCu√°ntos a√±os de experiencia laboral tienes? <span class="text-danger">*</span></label>
            {% for val,label in [('1 a√±o','1 a√±o'),('2 a√±os','2 a√±os'),('3 a√±os o m√°s','3 a√±os o m√°s'),('Sin experiencia','Sin experiencia')] %}
              <div class="form-check">
                <input class="form-check-input" type="radio" name="anos_experiencia" id="exp_{{ loop.index }}" value="{{ val }}" required>
                <label class="form-check-label" for="exp_{{ loop.index }}">{{ label }}</label>
              </div>
            {% endfor %}
          </div>

          <!-- √Åreas de experiencia -->
          <div class="col-md-6">
            <label class="form-label">√Åreas de experiencia <span class="text-danger">*</span> <small class="text-muted">(marca todas las que correspondan)</small></label>
            <div class="row">
              {% for area in ['Limpieza','Cocinera','Ni√±era','Cuidar envejeciente','Todas las anteriores','Enfermer√≠a'] %}
                <div class="col-12 col-sm-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="areas_experiencia" id="area_{{ loop.index }}" value="{{ area }}">
                    <label class="form-check-label" for="area_{{ loop.index }}">{{ area }}</label>
                  </div>
                </div>
              {% endfor %}
            </div>
            <div class="form-text">Puedes seleccionar varias opciones.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Paso 4: Habilidades y pol√≠ticas -->
    <div class="card mb-3">
      <div class="card-header d-flex align-items-center gap-2">
        <i class="fa-solid fa-list-check"></i>
        <strong>Habilidades y pol√≠ticas</strong>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <!-- Sabe planchar -->
          <div class="col-md-6">
            <label class="form-label">¬øSabes planchar? <span class="text-danger">*</span></label>
            <div class="d-flex gap-3">
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="sabe_planchar" id="planch_si" value="si" required>
                <label class="form-check-label" for="planch_si">S√≠</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="sabe_planchar" id="planch_no" value="no">
                <label class="form-check-label" for="planch_no">No</label>
              </div>
            </div>
          </div>

          <!-- Acepta porcentaje -->
          <div class="col-md-6">
            <label class="form-label">¬øAceptas que cobremos un % de tu sueldo como honorarios? <span class="text-danger">*</span></label>
            <div class="form-text mb-1">Es un √∫nico pago que te explicamos al final.</div>
            <div class="d-flex gap-3">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="acepta_porcentaje_sueldo" id="acepta_si" value="si" required>
                <label class="form-check-label" for="acepta_si">S√≠</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="acepta_porcentaje_sueldo" id="acepta_no" value="no">
                <label class="form-check-label" for="acepta_no">No</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Paso 5: Referencias -->
    <div class="card mb-3">
      <div class="card-header d-flex align-items-center gap-2">
        <i class="fa-solid fa-people-group"></i>
        <strong>Referencias</strong>
      </div>
      <div class="card-body">
        <!-- Referencias laborales -->
        <div class="mb-3">
          <label for="contactos_referencias_laborales" class="form-label">Dos contactos de referencias laborales <span class="text-danger">*</span></label>
          <div class="input-group">
            <span class="input-group-text"><i class="fa-solid fa-briefcase"></i></span>
            <textarea class="form-control" id="contactos_referencias_laborales" name="contactos_referencias_laborales" rows="3" required placeholder="Nombre completo ‚Äî Tel√©fono ‚Äî Relaci√≥n laboral (uno por p√°rrafo)"></textarea>
          </div>
        </div>

        <!-- Referencias familiares -->
        <div class="mb-1">
          <label for="referencias_familiares_detalle" class="form-label">Dos referencias familiares <span class="text-danger">*</span></label>
          <div class="input-group">
            <span class="input-group-text"><i class="fa-solid fa-user-group"></i></span>
            <textarea class="form-control" id="referencias_familiares_detalle" name="referencias_familiares_detalle" rows="3" required placeholder="Nombre completo ‚Äî Tel√©fono ‚Äî Parentesco (no vecinos ni amigos)"></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- Enviar -->
    <div class="d-flex justify-content-center">
      <button type="submit" class="btn btn-success btn-lg px-4" id="btnSubmit">
        <i class="fa-solid fa-paper-plane me-2"></i>Enviar
      </button>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    // Deshabilitar bot√≥n al enviar (anti-doble submit)
    (function(){
      const form = document.querySelector('form[action="{{ url_for("register") }}"]');
      const btn  = document.getElementById('btnSubmit');
      if(form && btn){
        form.addEventListener('submit', function(){
          btn.disabled = true;
          btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Enviando‚Ä¶';
        });
      }
    })();

    // Formateo amable de c√©dula: 000-0000000-0 (no altera validaci√≥n del backend)
    (function(){
      const ced = document.getElementById('cedula');
      if(!ced) return;
      ced.addEventListener('input', function(){
        const digits = this.value.replace(/\D/g,'').slice(0,11);
        let out = digits;
        if(digits.length > 3) out = digits.slice(0,3) + '-' + digits.slice(3);
        if(digits.length > 10) out = digits.slice(0,3) + '-' + digits.slice(3,10) + '-' + digits.slice(10);
        this.value = out;
      });
    })();

    // Hint: normalizar tel√©fono simple (opcional, no bloquea)
    (function(){
      const tel = document.getElementById('numero_telefono');
      if(!tel) return;
      tel.addEventListener('blur', function(){
        this.value = this.value.trim().replace(/\s+/g, ' ');
      });
    })();
  </script>
{% endblock %}
