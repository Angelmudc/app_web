<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcular Porcentaje de Pago</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <div class="container">
        <h2>Calcular Porcentaje de Pago</h2>

        <form id="formulario">
            <label for="busqueda">Buscar Candidata (Código, Nombre o Cédula):</label>
            <input type="text" id="busqueda" name="busqueda" required>
            <button type="submit">Buscar</button>
        </form>

        <div id="info_candidata" style="display: none;">
            <h3>Datos de la Candidata</h3>
            <p><strong>Nombre:</strong> <span id="nombre"></span></p>
            <p><strong>Cédula:</strong> <span id="cedula"></span></p>
            <p><strong>Teléfono:</strong> <span id="telefono"></span></p>
            <p><strong>Ciudad:</strong> <span id="ciudad"></span></p>

            <label for="fecha_inicio">Fecha de Inicio:</label>
            <input type="date" id="fecha_inicio" name="fecha_inicio" required>

            <label for="monto_total">Monto Total:</label>
            <input type="number" id="monto_total" name="monto_total" required>

            <button id="calcular" disabled>Calcular</button>
        </div>

        <h3>Resultados:</h3>
        <p><strong>Porcentaje (25%):</strong> <span id="porcentaje"></span></p>
        <p><strong>Fecha de Pago:</strong> <span id="fecha_pago"></span></p>
    </div>

    <script>
        $(document).ready(function() {
            $("#formulario").submit(function(event) {
                event.preventDefault();
                let busqueda = $("#busqueda").val().trim();

                $.ajax({
                    url: "/porciento",
                    type: "POST",
                    data: { busqueda: busqueda },
                    success: function(response) {
                        $("#nombre").text(response.candidata.nombre);
                        $("#cedula").text(response.candidata.cedula);
                        $("#telefono").text(response.candidata.telefono);
                        $("#ciudad").text(response.candidata.ciudad);
                        $("#info_candidata").show();
                        $("#calcular").prop("disabled", false);
                    },
                    error: function(xhr) {
                        alert("Error: " + xhr.responseJSON.error);
                    }
                });
            });

            $("#calcular").click(function() {
                let fecha_inicio = $("#fecha_inicio").val();
                let monto_total = $("#monto_total").val();

                $.ajax({
                    url: "/porciento",
                    type: "POST",
                    data: {
                        busqueda: $("#busqueda").val(),
                        fecha_inicio: fecha_inicio,
                        monto_total: monto_total
                    },
                    success: function(response) {
                        $("#porcentaje").text(response.porcentaje);
                        $("#fecha_pago").text(response.fecha_pago);
                    },
                    error: function(xhr) {
                        alert("Error: " + xhr.responseJSON.error);
                    }
                });
            });
        });
    </script>

</body>
</html>