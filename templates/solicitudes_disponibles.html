<!-- templates/solicitudes_disponibles.html -->
{% extends "solicitudes_layout.html" %}

{% block content %}
  <h1 class="mb-4">칍rdenes Disponibles / Reemplazo</h1>
  
  {% if mensaje %}
    <div class="alert alert-info fade-in">{{ mensaje }}</div>
  {% endif %}

  {% if solicitudes|length > 1 %}
    {% set header = solicitudes[0] %}
    {% for orden in solicitudes[1:] %}
      <!-- Suponemos que la fila real est치 almacenada en orden[?] o seg칰n tu dise침o; 
           en este ejemplo, usaremos loop.index m치s 1 como n칰mero de fila.
           Ajusta esto seg칰n corresponda a tu estructura. -->
      <div class="card mb-3 fade-in">
        <div class="card-body">
          <pre id="orderText{{ loop.index }}" style="white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
Disponible ( {{ orden[0] }} )
游늸 {{ orden[13] }}
Ruta m치s cercana ( {{ orden[14] }} )

{{ orden[15] }}

Edad: {{ orden[16] }}
{{ orden[17] }}
Que sepa leer y escribir
Experiencia en: {{ orden[19] }}
Horario: {{ orden[20] }}

Funciones: {{ orden[21] }}

{{ orden[22] }}

{{ orden[23] }}

Sueldo:$ {{ orden[24] }}
{% if orden[25] %}
{{ orden[25] }}
{% endif %}
          </pre>
          <!--
            El bot칩n de Copiar invoca copyOrderText enviando dos par치metros:
             - loop.index para identificar el bloque de texto.
             - (loop.index + 1) como ejemplo de n칰mero de fila. 
            Ajusta esta l칩gica seg칰n c칩mo determines la fila en tu hoja.
          -->
          <button class="btn btn-primary" onclick='copyOrderText("{{ loop.index }}", "{{ loop.index + 1 }}")'>Copiar Orden</button>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p class="fade-in">No hay 칩rdenes disponibles o de reemplazo para copiar.</p>
  {% endif %}

  <script>
    function copyOrderText(index, fila) {
      // Se obtiene el contenido del elemento <pre>
      var textElem = document.getElementById("orderText" + index);
      if (!textElem) {
        alert("No se pudo encontrar el contenido a copiar.");
        return;
      }
      var text = textElem.innerText;
      navigator.clipboard.writeText(text).then(function() {
        alert("Orden copiada al portapapeles");
        // Llamada para marcar la orden como copiada (actualiza la columna AC con la fecha de hoy)
        // Se env칤a el n칰mero de fila 'fila' al endpoint "/marcar_copiada"
        fetch('/marcar_copiada', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: 'fila=' + fila
        })
        .then(function(response) { return response.text(); })
        .then(function(data) { 
          console.log("Orden marcada: " + data);
          // Recargar la p치gina para actualizar la lista y que la orden copiada desaparezca
          location.reload(); 
        })
        .catch(function(err) {
          alert("Error al marcar la orden: " + err);
        });
      }).catch(function(err) {
        alert("Error al copiar la orden: " + err);
      });
    }
  </script>
{% endblock %}
