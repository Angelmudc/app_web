{% extends "public/base_public.html" %}

{% block title %}Domésticas disponibles - Doméstica del Cibao A&D{% endblock %}

{% block content %}
<section class="section">
  <div class="container">
    <h1 class="section-title">Domésticas disponibles</h1>
    <p class="section-subtitle">
      Estas candidatas se cargan directamente desde nuestro sistema interno. Cuando actualizamos en la oficina, se actualiza aquí también.
    </p>

    <!-- Estado silencioso de actualización (modo pro) -->
    <div id="liveStatus" style="display:none; margin:10px 0; color:#667085; font-size:14px;">
      Actualizando listado...
    </div>

    <div id="domesticasGrid" class="grid-3">
      {% for d in domesticas %}
      <div class="card card-domestica">

        <!-- Encabezado: solo estado disponible -->
        <div class="card-domestica-header">
          <span class="badge badge-success">Disponible</span>
        </div>

        <!-- Avatar centrado (clic para ver grande) -->
        {% if d.foto %}
        <div class="card-domestica-avatar">
          <img
            src="{{ d.foto }}"
            alt="Foto de {{ d.nombre }}"
            loading="lazy"
            referrerpolicy="no-referrer"
            onclick="verImagenCompleta(this.src)"
          >
        </div>
        {% endif %}

        <!-- Nombre y edad -->
        <h3 class="card-domestica-nombre">
          {{ d.nombre }}{% if d.edad %}, {{ d.edad }} años{% endif %}
        </h3>

        <!-- Código (identificador interno visible para el cliente) -->
        {% if d.codigo %}
        <p class="card-domestica-codigo">
          <span class="badge badge-dark">Código: {{ d.codigo }}</span>
        </p>
        {% endif %}

        <!-- Modalidad / ciudad corta -->
        <p class="card-domestica-meta">
          {% if d.modalidad %}
            {{ d.modalidad }}
          {% else %}
            Doméstica disponible
          {% endif %}
          {% if d.ciudad %}
            · {{ d.ciudad }}
          {% endif %}
        </p>

        <!-- Acciones principales -->
        <div class="card-domestica-actions">
          {# Asegura el id para el detalle aunque el dict venga con otro nombre.
             Nota: la ruta `public.detalle_domestica` responde en /domesticas/<int:candidata_pk>. #}
          {% set detalle_id = d.pk or d.public_id or d.id %}

          {% if detalle_id %}
          <a
            href="/domesticas/{{ detalle_id }}"
            class="btn btn-outline btn-ver-detalle"
            rel="nofollow"
          >
            Ver detalles
          </a>
          {% endif %}

          <button
            type="button"
            class="btn btn-secondary btn-oferta"
            data-codigo="{{ d.codigo or '' }}"
            onclick="ofrecerEmpleo(this)"
          >
            Ofrecer empleo
          </button>
        </div>
      </div>
      {% endfor %}
    </div>

    {% if domesticas|length == 0 %}
      <p class="info-text">
        Por el momento no hay candidatas para mostrar. Vuelve más tarde o contáctanos por WhatsApp.
      </p>
    {% endif %}

    {% if pagination and pagination.pages > 1 %}
    <nav class="pagination">
      {% if pagination.has_prev %}
        <a href="{{ url_for('public.domesticas', page=pagination.prev_num) }}" class="page-link" rel="nofollow">
          ← Anterior
        </a>
      {% endif %}
      <span class="page-info">
        Página {{ pagination.page }} de {{ pagination.pages }}
      </span>
      {% if pagination.has_next %}
        <a href="{{ url_for('public.domesticas', page=pagination.next_num) }}" class="page-link" rel="nofollow">
          Siguiente → 
        </a>
      {% endif %}
    </nav>
    {% endif %}
  </div>
</section>

<section class="section cta-section">
  <div class="container cta-inner">
    <div>
      <h2>¿Te interesa alguna candidata?</h2>
      <p>
        Presiona “Ofrecer empleo” y envíanos tu propuesta. Nosotros gestionamos todo el proceso con la doméstica.
      </p>
    </div>
    <a href="#" class="btn btn-primary" data-solicitar-domestica>
      Ver otras opciones por WhatsApp
    </a>
  </div>
</section>

<!-- MODAL PARA VER LA FOTO EN GRANDE -->
<div id="modalImagen" class="modal-imagen">
  <span class="cerrar-modal" onclick="cerrarImagen()">&times;</span>
  <img class="modal-contenido" id="imgModalGrande" alt="Foto candidata">
</div>

<!-- JS específico para el visor de imagen -->
<script>
  function verImagenCompleta(src) {
    const modal = document.getElementById('modalImagen');
    const img = document.getElementById('imgModalGrande');
    img.src = src;
    modal.style.display = 'block';
  }

  function cerrarImagen() {
    const modal = document.getElementById('modalImagen');
    modal.style.display = 'none';
  }

  // Cerrar si se hace clic fuera de la imagen
  window.addEventListener('click', function (e) {
    const modal = document.getElementById('modalImagen');
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  });
</script>
<script>
  function ofrecerEmpleo(elOrCodigo) {
    // Soporta: ofrecerEmpleo(this)  ó  ofrecerEmpleo('COD-123')
    let codigo = "";

    if (typeof elOrCodigo === "string") {
      codigo = elOrCodigo;
    } else if (elOrCodigo && elOrCodigo.dataset) {
      codigo = elOrCodigo.dataset.codigo || "";
    }

    codigo = (codigo || "").toString().trim();

    if (!codigo) {
      alert("Código de candidata no disponible.");
      return;
    }

    const mensaje = encodeURIComponent(
      `Hola, me interesa la candidata con el código ${codigo}. Quisiera ofrecer un empleo y recibir más información.`
    );

    const telefono = "18094296892"; // WhatsApp oficial
    const url = `https://wa.me/${telefono}?text=${mensaje}`;

    window.open(url, "_blank", "noopener,noreferrer");
  }
</script>
{% endblock %}
