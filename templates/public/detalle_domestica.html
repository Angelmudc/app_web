{% extends "public/base_public.html" %}

{% block title %}Detalle de candidata - Doméstica del Cibao A&D{% endblock %}

{% block content %}
<section class="section">
  <div class="container detalle-candidata">
    <a href="{{ url_for('public.domesticas') }}" class="back-link">
      ← Volver a domésticas disponibles
    </a>

    <div class="detalle-card">

      {% if candidata.foto %}
      <div class="detalle-avatar">
        <img
          src="{{ candidata.foto }}"
          alt="Foto de {{ candidata.nombre }}"
          loading="lazy"
          referrerpolicy="no-referrer"
          onclick="verImagenCompleta(this.src)"
          style="cursor: zoom-in;"
        >
      </div>
      {% endif %}

      <div class="detalle-info">

        <h1 class="detalle-nombre">
          {{ candidata.nombre }}
        </h1>

        {% if candidata.edad %}
          <p class="detalle-edad text-muted">
            {{ candidata.edad }}
          </p>
        {% endif %}

        {% if candidata.frase_destacada %}
          <p class="detalle-frase">
            “{{ candidata.frase_destacada }}”
          </p>
        {% endif %}

        <div class="detalle-meta">
          {% if candidata.codigo %}
            <span class="badge badge-primario">
              Código: {{ candidata.codigo }}
            </span>
          {% endif %}

          {% if candidata.tipo_servicio %}
            <span class="badge badge-secundario">
              {{ candidata.tipo_servicio }}
            </span>
          {% endif %}

          {% if candidata.disponible_inmediato %}
            <span class="badge badge-success">
              Disponible para iniciar de inmediato
            </span>
          {% endif %}
        </div>

        <div class="detalle-ubicacion">
          {% if candidata.ciudad or candidata.sector %}
            <p class="detalle-line">
              <strong>Zona:</strong>
              {% if candidata.ciudad %}{{ candidata.ciudad }}{% endif %}
              {% if candidata.ciudad and candidata.sector %} – {% endif %}
              {% if candidata.sector %}{{ candidata.sector }}{% endif %}
            </p>
          {% endif %}

          {% if candidata.modalidad %}
            <p class="detalle-line">
              <strong>Modalidad:</strong> {{ candidata.modalidad }}
            </p>
          {% endif %}

          {% if candidata.anos_experiencia %}
            <p class="detalle-line">
              <strong>Experiencia:</strong> {{ candidata.anos_experiencia }}
            </p>
          {% endif %}
        </div>

        {% if candidata.sueldo or candidata.sueldo_desde or candidata.sueldo_hasta %}
        <div class="detalle-sueldo">
          <h2>Sueldo de referencia</h2>
          {% if candidata.sueldo %}
            <p>{{ candidata.sueldo }}</p>
          {% else %}
            <p>
              {% if candidata.sueldo_desde %}
                Desde RD$ {{ candidata.sueldo_desde }}
              {% endif %}
              {% if candidata.sueldo_desde and candidata.sueldo_hasta %}
                &nbsp;–&nbsp;
              {% endif %}
              {% if candidata.sueldo_hasta %}
                hasta RD$ {{ candidata.sueldo_hasta }}
              {% endif %}
            </p>
          {% endif %}
          <p class="text-muted small">
            *Montos orientativos, se confirman según horario y funciones.
          </p>
        </div>
        {% endif %}

        {% if candidata.experiencia %}
        <div class="detalle-experiencia">
          <h2>Experiencia</h2>
          <p>{{ candidata.experiencia }}</p>
        </div>
        {% endif %}

        {% if candidata.experiencia_detallada %}
        <div class="detalle-experiencia-detallada">
          <h2>Detalle de experiencia</h2>
          <p>
            {{ candidata.experiencia_detallada
               |replace('\n', '<br>')|safe }}
          </p>
        </div>
        {% endif %}

        {% if candidata.tags %}
        <div class="detalle-tags">
          <h2>Habilidades y fortalezas</h2>
          <div class="tags-list">
            {% for tag in candidata.tags.split(',') %}
              {% if tag.strip() %}
                <span class="tag-item">{{ tag.strip() }}</span>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <div class="detalle-cta">
          <p class="detalle-cta-text">
            Si te interesa esta candidata, escríbenos por WhatsApp indicando el código
            {% if candidata.codigo %}
              <strong>{{ candidata.codigo }}</strong>.
            {% else %}
              que aparece en su ficha.
            {% endif %}
          </p>

          {# WhatsApp oficial (mismo que usas en la lista) #}
          {% set wa_number = '18094296892' %}

          {# ✅ El código SIEMPRE debe ir en el mensaje #}
          {% set codigo_txt = (candidata.codigo or 'Código no disponible') %}
          {% set nombre_txt = (candidata.nombre or '') %}
          {% set ciudad_txt = (candidata.ciudad or '') %}

          {% set wa_text = (
            'Hola, me interesa la candidata (CÓDIGO: ' ~ codigo_txt ~ ')' ~
            (nombre_txt and ' ' ~ nombre_txt or '') ~
            (ciudad_txt and ' de ' ~ ciudad_txt or '') ~
            '. Quiero más información, por favor.'
          ) %}

          <div class="detalle-cta-buttons">
            <a
              href="https://wa.me/{{ wa_number }}?text={{ wa_text|urlencode }}"
              target="_blank"
              rel="noopener"
              class="btn btn-primary"
            >
              Ofrecer empleo por WhatsApp
            </a>

            <a
              href="{{ url_for('public.domesticas') }}"
              class="btn btn-outline"
            >
              Ver otras candidatas
            </a>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

{# ===== MODAL PARA VER IMAGEN EN GRANDE (se conserva) ===== #}
<div id="modalImagen" class="modal-imagen">
  <span class="cerrar-modal" onclick="cerrarImagen()">&times;</span>
  <img class="modal-contenido" id="imgModalGrande" alt="Foto candidata">
</div>

<script>
  function verImagenCompleta(src) {
    const modal = document.getElementById('modalImagen');
    const img = document.getElementById('imgModalGrande');
    img.src = src;
    modal.style.display = 'block';
  }

  function cerrarImagen() {
    document.getElementById('modalImagen').style.display = 'none';
  }

  window.addEventListener('click', function (e) {
    const modal = document.getElementById('modalImagen');
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  });
</script>

{% endblock %}
