{% extends "ordenes_base.html" %}

{% block content %}
<div class="container mt-4">
  {% if candidato %}
    <h1 class="mb-4 text-center">Detalle del Candidato: {{ candidato["Nombre"] }}</h1>
    {% if mensaje %}
      <div class="alert alert-info">{{ mensaje }}</div>
    {% endif %}
    
    <!-- Un solo formulario con una tabla editable -->
    <form id="detalleForm" method="POST" action="{{ url_for('otros_detalle', identifier=candidato['Nombre'] if candidato['Nombre']|trim != '' else candidato['Cédula']) }}">
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead>
            <tr>
              {% for col in short_headers %}
                <th>{{ col }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            <tr>
              {% for col in short_headers %}
                {% set idx = loop.index0 %}
                <td>
                  <input type="text" name="col{{ idx + 2 }}" class="form-control detail-input" 
                         value="{{ candidato[col] }}" 
                         {% if idx < 16 %} disabled {% else %} readonly {% endif %}>
                  {# Los primeros 16 inputs (para índices 2 a 17) son editables solo cuando se habilitan; 
                     los últimos dos (para Código y Fecha) permanecen solo lectura #}
                </td>
              {% endfor %}
            </tr>
          </tbody>
        </table>
      </div>
      <div class="text-center">
         <button type="button" id="editarBtn" class="btn btn-primary" onclick="enableEditing()">Editar</button>
         <button type="submit" id="guardarBtn" class="btn btn-success" style="display:none;">Guardar Cambios</button>
      </div>
    </form>
    
    <script>
      function enableEditing() {
         var inputs = document.querySelectorAll('.detail-input');
         // Habilitar solo los primeros 16 inputs (correspondientes a columnas C a R)
         for (var i = 0; i < inputs.length; i++) {
            if (i < 16) {
               inputs[i].disabled = false;
            }
         }
         document.getElementById("editarBtn").style.display = "none";
         document.getElementById("guardarBtn").style.display = "inline-block";
      }
    </script>
    
  {% else %}
    <div class="alert alert-danger">Candidato no encontrado.</div>
    <a href="{{ url_for('otros_listar') }}" class="btn btn-secondary">Volver al Listado</a>
  {% endif %}
</div>
{% endblock %}
