{% extends "base.html" %}

{% block title %}Iniciar sesi√≥n{% endblock %}

{% block head %}
<style>
  /* ======= Fondo ======= */
  .login-stage{
    position: relative;
    min-height: 62vh;
    display:grid; place-items:center;
  }
  .blob{position:absolute; border-radius:50%; filter:blur(40px); opacity:.35; pointer-events:none;}
  .b1{width:420px;height:420px;left:-120px;top:-80px;background: var(--brand-2);}
  .b2{width:460px;height:460px;right:-140px;top:-60px;background: var(--brand);}
  .b3{width:520px;height:520px;left:50%;bottom:-220px;transform:translateX(-50%);background:#22d3ee;opacity:.18}

  /* ======= Card GLASS ======= */
  .glass{
    width: min(980px, 100%);
    border-radius: 22px;
    border: 1px solid color-mix(in srgb, var(--border) 55%, transparent);
    background: color-mix(in srgb, var(--card) 55%, transparent);
    backdrop-filter: saturate(160%) blur(14px);
    box-shadow: 0 22px 60px rgba(15,23,42,.14);
    overflow: hidden;
    animation: glassIn .45s ease both;
  }
  @keyframes glassIn { from{opacity:0; transform: translateY(8px)} to{opacity:1; transform:none} }

  /* Borde con brillo animado */
  .glass::before{
    content:"";
    position:absolute; inset:-1px;
    border-radius: inherit;
    padding:1px;
    background: conic-gradient(
      from 0deg,
      #7aa2ff, #22d3ee, #34d399, #7aa2ff
    );
    -webkit-mask:
      linear-gradient(#000 0 0) content-box,
      linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
            mask-composite: exclude;
    animation: spinHue 6s linear infinite;
    opacity:.35;
  }
  @keyframes spinHue { to{ transform: rotate(360deg) } }

  .glass-row{display:grid; grid-template-columns: 1.1fr .9fr; gap: 0; }
  @media (max-width: 992px){ .glass-row{ grid-template-columns: 1fr; } }

  /* ======= Columna marca ======= */
  .brand-col{
    padding: 40px 26px;
    background: linear-gradient(180deg, color-mix(in srgb, var(--brand-2) 12%, transparent), transparent);
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    text-align:center; border-right:1px solid var(--border);
  }
  @media (max-width: 992px){ .brand-col{ border-right:none; border-bottom:1px solid var(--border); } }

  .brand-logo{
    width: min(260px, 70%);
    height:auto;
    display:block;
    filter: drop-shadow(0 10px 24px rgba(15,23,42,.15));
    animation: floatY 5s ease-in-out infinite;
  }
  @keyframes floatY{ 0%,100%{ transform: translateY(0)} 50%{ transform: translateY(-6px)} }

  .brand-title{font-family:'Rubik', system-ui; font-weight:800; letter-spacing:.2px; margin-top:18px;}
  .brand-sub{color: var(--muted); margin-top:4px}

  /* ======= Columna formulario ======= */
  .form-col{ padding: 22px; }

  .form-head{display:flex; align-items:center; gap:10px; margin-bottom:6px;}
  .form-head .emoji{ font-size:1.35rem }
  .form-sub{ color: var(--muted); margin:0 0 6px 0 }

  .progress-thin{
    height:3px; width:100%;
    background: linear-gradient(90deg, var(--brand-2), var(--brand));
    opacity:0; transform: translateX(-100%);
  }
  .progress-thin.active{ opacity:1; animation: indeterminate 1.1s infinite linear; }
  @keyframes indeterminate{ 0%{transform: translateX(-100%);} 50%{transform: translateX(-20%);} 100%{transform: translateX(100%);} }

  .msg{
    margin-top: 10px; padding: 12px 14px;
    border-radius: 12px; border: 1px solid var(--border);
    background: #fff; color:#a52834;
  }
  html[data-theme="dark"] .msg{ background:#121a2a; border-color:#1e2636; color:#ffb3ba; }

  .input-icon{
    position:absolute; left:12px; top:50%; transform: translateY(-50%);
    width:20px; height:20px; color:#7a8aa6; opacity:.9;
  }
  .form-control.auth{
    padding-left: 44px; border-radius: 14px;
    border:1.9px solid #e2e8f6; background: color-mix(in srgb, #ffffff 78%, transparent);
  }
  html[data-theme="dark"] .form-control.auth{
    background: color-mix(in srgb, #0f1624 92%, transparent); border-color:#1e2636; color: var(--text);
  }
  .form-control.auth:focus{
    border-color:#9db7ff; box-shadow: 0 0 0 6px rgba(157,183,255,.25);
  }
  .is-invalid{ border-color:#ef9aa0 !important; box-shadow: 0 0 0 6px rgba(217,83,79,.18) !important; }

  .toggle-btn{
    position:absolute; right:10px; top:50%; transform:translateY(-50%);
    border:1px solid #e2e8f6; background: var(--card); color: var(--muted);
    border-radius: 10px; padding:6px 8px;
  }

  .caps-hint{ color:#b45309; font-size:.9rem; display:none; margin-top:6px }

  .btn-auth{
    width:100%; border-radius:999px; font-weight:900;
    padding:.9rem 1rem; letter-spacing:.2px;
    border:none; color: #fff;
    background:
      radial-gradient(120% 120% at 10% -10%, rgba(255,255,255,.25), transparent 35%),
      linear-gradient(135deg, #3b82f6, var(--brand));
    box-shadow: 0 14px 30px rgba(59,130,246,.22);
    position:relative; overflow:hidden;
    transition: transform .12s ease, filter .2s ease, box-shadow .2s ease;
  }
  .btn-auth:hover{ transform: translateY(-1px); filter: brightness(1.02); }
  .btn-auth:focus{ box-shadow: 0 0 0 6px var(--ring) !important; }
  .btn-auth[disabled]{ opacity:.85; cursor:not-allowed; }

  .spin{
    width:16px; height:16px; border-radius:50%;
    border:2px solid rgba(255,255,255,.6); border-top-color:#fff;
    display:none; margin-right:8px;
    animation: spin .8s linear infinite;
  }
  @keyframes spin{ to{ transform: rotate(360deg); } }

  .btn-auth.success{
    background: linear-gradient(135deg, #16a34a, #22c55e);
    box-shadow: 0 14px 30px rgba(34,197,94,.28);
  }

  .shake{ animation: shake .42s cubic-bezier(.36,.07,.19,.97) both; }
  @keyframes shake{
    10%, 90% { transform: translateX(-1px); }
    20%, 80% { transform: translateX(2px); }
    30%, 50%, 70% { transform: translateX(-4px); }
    40%, 60% { transform: translateX(4px); }
  }
</style>
{% endblock %}

{% block content %}
<div class="login-stage container">
  <div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div>

  <section class="glass">
    <div class="glass-row">
      <!-- Columna marca -->
      <aside class="brand-col">
        <img class="brand-logo" src="{{ url_for('static', filename='logo_nuevo.png') }}" alt="Dom√©stica del Cibao A&amp;D">
        <h3 class="brand-title h4">Dom√©stica del Cibao A&amp;D</h3>
        <p class="brand-sub">Plataforma de gesti√≥n y selecci√≥n</p>
      </aside>

      <!-- Columna formulario -->
      <div class="form-col">
        <div class="progress-thin" id="topProgress" aria-hidden="true"></div>

        <div class="form-head">
          <div class="emoji">üîë</div>
          <div>
            <h1 class="h4 m-0 fw-bold">Iniciar sesi√≥n</h1>
            <p class="form-sub">Accede con tus credenciales</p>
          </div>
        </div>

        {% if mensaje %}
          <div class="msg" role="alert" aria-live="polite">{{ mensaje }}</div>
        {% endif %}

        <form method="POST" action="{{ url_for('login') }}" id="loginForm" autocomplete="on" novalidate>
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <input type="text" name="website" tabindex="-1" autocomplete="off" aria-hidden="true" style="position:absolute; left:-9999px; width:1px; height:1px; opacity:0;">

          <!-- Usuario -->
          <div class="mb-3 position-relative">
            <label for="usuario" class="form-label fw-bold">Usuario</label>
            <svg class="input-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z"/></svg>
            <input id="usuario" name="usuario" type="text" class="form-control auth" placeholder="tu.usuario" required>
          </div>

          <!-- Contrase√±a -->
          <div class="mb-2 position-relative">
            <label for="clave" class="form-label fw-bold">Contrase√±a</label>
            <svg class="input-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M17 10h-1V8a4 4 0 1 0-8 0v2H7a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-8a1 1 0 0 0-1-1Zm-7-2a2 2 0 1 1 4 0v2h-4Zm2 9a1.75 1.75 0 1 1 1.75-1.75A1.75 1.75 0 0 1 12 17Z"/></svg>
            <input id="clave" name="clave" type="password" class="form-control auth" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
            <button class="toggle-btn btn btn-sm" type="button" id="togglePwd"><i class="fa-solid fa-eye-slash"></i></button>
            <div class="caps-hint" id="capsHint">Bloq May√∫s activo.</div>
          </div>

          <button type="submit" class="btn btn-auth mt-3" id="submitBtn">
            <span class="spin" id="spinner"></span>
            <span id="btnText">Entrar</span>
          </button>
        </form>
      </div>
    </div>
  </section>
</div>
{% endblock %}

{% block scripts %}
<script>
(function(){
  const form = document.getElementById('loginForm');
  const card = document.querySelector('.glass');
  const bar  = document.getElementById('topProgress');
  const user = document.getElementById('usuario');
  const pass = document.getElementById('clave');
  const btn  = document.getElementById('submitBtn');
  const spin = document.getElementById('spinner');
  const btxt = document.getElementById('btnText');
  const tgl  = document.getElementById('togglePwd');
  const caps = document.getElementById('capsHint');

  document.addEventListener('DOMContentLoaded',()=>{(user.value.trim()?pass:user).focus();});
  tgl.addEventListener('click',()=>{const isPwd=pass.type==='password';pass.type=isPwd?'text':'password';tgl.innerHTML=isPwd?'<i class="fa-solid fa-eye"></i>':'<i class="fa-solid fa-eye-slash"></i>';});
  const capsHandler=(e)=>{const on=e.getModifierState&&e.getModifierState('CapsLock');caps.style.display=on?'block':'none';};
  pass.addEventListener('keydown',capsHandler);pass.addEventListener('keyup',capsHandler);

  form.addEventListener('submit',(e)=>{
    user.value=user.value.trim();
    if(user.value.length<3||!pass.value){e.preventDefault();card.classList.remove('shake');void card.offsetWidth;card.classList.add('shake');return;}
    btn.disabled=true;spin.style.display='inline-block';btxt.textContent='Entrando‚Ä¶';bar.classList.add('active');
    setTimeout(()=>{btn.classList.add('success');spin.style.display='none';btxt.textContent='¬°Listo! ‚úÖ';},800);
  });
})();
</script>
{% endblock %}
