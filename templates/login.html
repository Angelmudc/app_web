{% extends "base.html" %}

{% block title %}Iniciar sesi√≥n{% endblock %}

{% block content %}
<div class="login-stage page-login container">
  <div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div>

  <section class="glass">
    <div class="glass-row">
      <!-- Columna marca -->
      <aside class="brand-col">
        <img class="brand-logo" src="{{ url_for('static', filename='logo_nuevo.png') }}" alt="Dom√©stica del Cibao A&amp;D">
        <h3 class="brand-title h4">Dom√©stica del Cibao A&amp;D</h3>
        <p class="brand-sub">Plataforma de gesti√≥n y selecci√≥n</p>
      </aside>

      <!-- Columna formulario -->
      <div class="form-col">
        <div class="progress-thin" id="topProgress" aria-hidden="true"></div>

        <div class="form-head">
          <div class="emoji">üîë</div>
          <div>
            <h1 class="h4 m-0 fw-bold">Iniciar sesi√≥n</h1>
            <p class="form-sub">Accede con tus credenciales</p>
          </div>
        </div>

        {% if mensaje %}
          <div class="msg" role="alert" aria-live="polite">{{ mensaje }}</div>
        {% endif %}

        <form method="POST" action="{{ url_for('login') }}" id="loginForm" autocomplete="on" novalidate>
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <input type="text" name="website" tabindex="-1" autocomplete="off" aria-hidden="true" style="position:absolute; left:-9999px; width:1px; height:1px; opacity:0;">

          <!-- Usuario -->
          <div class="mb-3 position-relative">
            <label for="usuario" class="form-label fw-bold">Usuario</label>
            <svg class="input-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z"/></svg>
            <input id="usuario" name="usuario" type="text" class="form-control auth" placeholder="tu.usuario" required>
          </div>

          <!-- Contrase√±a -->
          <div class="mb-2 position-relative">
            <label for="clave" class="form-label fw-bold">Contrase√±a</label>
            <svg class="input-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M17 10h-1V8a4 4 0 1 0-8 0v2H7a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-8a1 1 0 0 0-1-1Zm-7-2a2 2 0 1 1 4 0v2h-4Zm2 9a1.75 1.75 0 1 1 1.75-1.75A1.75 1.75 0 0 1 12 17Z"/></svg>
            <input id="clave" name="clave" type="password" class="form-control auth" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
            <button class="toggle-btn btn btn-sm" type="button" id="togglePwd"><i class="fa-solid fa-eye-slash"></i></button>
            <div class="caps-hint" id="capsHint">Bloq May√∫s activo.</div>
          </div>

          <button type="submit" class="btn btn-auth mt-3" id="submitBtn">
            <span class="spin" id="spinner"></span>
            <span id="btnText">Entrar</span>
          </button>
        </form>
      </div>
    </div>
  </section>
</div>
{% endblock %}

{% block scripts %}
<script>
(function(){
  const form = document.getElementById('loginForm');
  const card = document.querySelector('.glass');
  const bar  = document.getElementById('topProgress');
  const user = document.getElementById('usuario');
  const pass = document.getElementById('clave');
  const btn  = document.getElementById('submitBtn');
  const spin = document.getElementById('spinner');
  const btxt = document.getElementById('btnText');
  const tgl  = document.getElementById('togglePwd');
  const caps = document.getElementById('capsHint');

  document.addEventListener('DOMContentLoaded',()=>{(user.value.trim()?pass:user).focus();});
  tgl.addEventListener('click',()=>{const isPwd=pass.type==='password';pass.type=isPwd?'text':'password';tgl.innerHTML=isPwd?'<i class="fa-solid fa-eye"></i>':'<i class="fa-solid fa-eye-slash"></i>';});
  const capsHandler=(e)=>{const on=e.getModifierState&&e.getModifierState('CapsLock');caps.style.display=on?'block':'none';};
  pass.addEventListener('keydown',capsHandler);pass.addEventListener('keyup',capsHandler);

  form.addEventListener('submit',(e)=>{
    user.value=user.value.trim();
    if(user.value.length<3||!pass.value){e.preventDefault();card.classList.remove('shake');void card.offsetWidth;card.classList.add('shake');return;}
    btn.disabled=true;spin.style.display='inline-block';btxt.textContent='Entrando‚Ä¶';bar.classList.add('active');
    setTimeout(()=>{btn.classList.add('success');spin.style.display='none';btxt.textContent='¬°Listo! ‚úÖ';},800);
  });
})();
</script>
{% endblock %}
