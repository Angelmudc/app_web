<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InscripciÃ³n de Candidatas</title>
    <script defer src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <h2>ğŸ” InscripciÃ³n de Candidatas</h2>

    <!-- Buscar Candidata -->
    <input type="text" id="busqueda" placeholder="Buscar por cÃ©dula o nombre">
    <button id="buscar">ğŸ” Buscar</button>

    <hr>

    <!-- Datos de la Candidata -->
    <h3>ğŸ“„ Datos de la Candidata</h3>
    <p><strong>CÃ³digo:</strong> <span id="codigo">Se generarÃ¡ automÃ¡ticamente</span></p>
    <p><strong>Nombre:</strong> <span id="nombre">No disponible</span></p>
    <p><strong>CÃ©dula:</strong> <span id="cedula">No disponible</span></p>
    <p><strong>TelÃ©fono:</strong> <span id="telefono">No disponible</span></p>
    <p><strong>Ciudad:</strong> <span id="ciudad">No disponible</span></p>

    <hr>

    <!-- Formulario para completar inscripciÃ³n -->
    <h3>ğŸ“ Completar InscripciÃ³n</h3>
    <form id="formInscripcion">
        <input type="hidden" id="fila_index"> <!-- Guarda la fila index para la actualizaciÃ³n -->

        <label for="estado">Estado:</label>
        <select id="estado">
            <option value="SÃ­" selected>SÃ­</option>
            <option value="No">No</option>
        </select>

        <label for="monto">Monto:</label>
        <input type="number" id="monto" placeholder="Ingrese el monto">

        <label for="fecha">Fecha:</label>
        <input type="date" id="fecha">

        <button type="button" id="guardar">ğŸ’¾ Guardar InscripciÃ³n</button>
    </form>

    <script>
        // ğŸ”¹ FunciÃ³n para buscar candidata
        document.getElementById("buscar").addEventListener("click", function() {
            const busqueda = document.getElementById("busqueda").value.trim();

            if (!busqueda) {
                alert("âš ï¸ Ingresa un nombre o cÃ©dula para buscar.");
                return;
            }

            fetch('/buscar_inscripcion?query=${encodeURIComponent(busqueda)}')
            .then(response => response.json())
            .then(data => {
                if (data.fila_index) {
                    document.getElementById("fila_index").value = data.fila_index;
                    document.getElementById("codigo").textContent = data.codigo || "Se generarÃ¡ automÃ¡ticamente";
                    document.getElementById("nombre").textContent = data.nombre || "No disponible";
                    document.getElementById("cedula").textContent = data.cedula || "No disponible";
                    document.getElementById("telefono").textContent = data.telefono || "No disponible";
                    document.getElementById("ciudad").textContent = data.ciudad || "No disponible";
                } else {
                    alert("âŒ No se encontrÃ³ la candidata.");
                }
            })
            .catch(error => {
                console.error("âŒ Error en la bÃºsqueda:", error);
                alert("âŒ Hubo un error al buscar la candidata.");
            });
        });

        // ğŸ”¹ FunciÃ³n para guardar inscripciÃ³n
        document.getElementById("guardar").addEventListener("click", function() {
            const filaIndex = document.getElementById("fila_index").value.trim();
            const estado = document.getElementById("estado").value;
            const monto = document.getElementById("monto").value.trim();
            const fecha = document.getElementById("fecha").value;

            if (!filaIndex) {
                alert("âš ï¸ Error: No se encontrÃ³ el Ã­ndice de la fila. Realiza la bÃºsqueda antes de guardar.");
                return;
            }

            if (!monto || !fecha) {
                alert("âš ï¸ Debes ingresar un monto y una fecha.");
                return;
            }

            fetch("/procesar_inscripcion", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    fila_index: filaIndex,
                    estado: estado,
                    monto: monto,
                    fecha: fecha
                })
            })
            .then(response => response.json())
            .then(data => {
    if (data.success) {
        alert("âœ… InscripciÃ³n guardada exitosamente.");
        location.reload();
    } else {
        alert('âŒ Error al actualizar: ${data.error}');
    }
})
.catch(error => {
    console.error("âŒ Error en la solicitud:", error);
    alert("âŒ Error al guardar la inscripciÃ³n. IntÃ©ntalo de nuevo.");
});
        });
    </script>

</body>
</html>