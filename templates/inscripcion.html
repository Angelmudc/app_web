<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscripción de Candidatas</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <h1>🔍 Inscripción de Candidatas</h1>

    <!-- Formulario de Búsqueda -->
    <form id="buscar-form">
        <input type="text" id="buscar" name="buscar" placeholder="Buscar por cédula o nombre">
        <button type="submit">🔍 Buscar</button>
    </form>

    <hr>

    <!-- Datos de la Candidata -->
    <h2>📋 Datos de la Candidata</h2>
    <p><strong>Código:</strong> <span id="codigo"></span></p>
    <p><strong>Nombre:</strong> <span id="nombre"></span></p>
    <p><strong>Cédula:</strong> <span id="cedula"></span></p>
    <p><strong>Teléfono:</strong> <span id="telefono"></span></p>
    <p><strong>Ciudad:</strong> <span id="ciudad"></span></p>
    <input type="hidden" id="fila_index" name="fila_index">

    <hr>

    <!-- Formulario para completar inscripción -->
    <h2>📝 Completar Inscripción</h2>
    <form id="inscripcion-form">
        <label for="estado">Estado:</label>
        <input type="text" id="estado" name="estado" value="Sí" readonly>

        <label for="monto">Monto:</label>
        <input type="number" id="monto" name="monto" required>

        <label for="fecha">Fecha:</label>
        <input type="date" id="fecha" name="fecha" required>

        <button type="submit">✅ Guardar Inscripción</button>
    </form>

    <script>
        // Función para buscar candidata
        document.getElementById('buscar-form').addEventListener('submit', function(event) {
            event.preventDefault();
            let busqueda = document.getElementById('buscar').value;

            fetch('/buscar_inscripcion', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ buscar: busqueda })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert("❌ " + data.error);
                } else {
                    document.getElementById('codigo').textContent = data.codigo || '';
                    document.getElementById('nombre').textContent = data.nombre || '';
                    document.getElementById('cedula').textContent = data.cedula || '';
                    document.getElementById('telefono').textContent = data.telefono || '';
                    document.getElementById('ciudad').textContent = data.ciudad || '';
                    document.getElementById('fila_index').value = data.fila_index;
                }
            })
            .catch(error => console.error('Error:', error));
        });

        // Función para guardar inscripción
        document.getElementById('inscripcion-form').addEventListener('submit', function(event) {
            event.preventDefault();
            let fila_index = document.getElementById('fila_index').value;
            let estado = document.getElementById('estado').value;
            let monto = document.getElementById('monto').value;
            let fecha = document.getElementById('fecha').value;

            if (!fila_index) {
                alert("⚠️ No se encontró el índice de la fila. Realiza una búsqueda antes de guardar.");
                return;
            }

            fetch('/procesar_inscripcion', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ fila_index, estado, monto, fecha })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert("❌ " + data.error);
                } else {
                    alert("✅ Inscripción guardada correctamente.");
                    document.getElementById('inscripcion-form').reset();
                }
            })
            .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>