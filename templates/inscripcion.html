<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscripci√≥n de Candidatas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: auto;
        }
        h1, h2 {
            color: #333;
        }
        label {
            font-weight: bold;
        }
        input, select, button {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        .alert {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: none;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
        }
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üîç Inscripci√≥n de Candidatas</h1>

    <label for="busqueda">Buscar por c√©dula o nombre:</label>
    <input type="text" id="busqueda">
    <button id="buscar">üîç Buscar</button>

    <h2>üìÑ Datos de la Candidata</h2>
    <p>C√≥digo: <strong><span id="codigo">Se generar√° autom√°ticamente</span></strong></p>
    <p>Nombre: <span id="nombre">No disponible</span></p>
    <p>C√©dula: <span id="cedula">No disponible</span></p>
    <p>Tel√©fono: <span id="telefono">No disponible</span></p>
    <p>Ciudad: <span id="ciudad">No disponible</span></p>

    <h2>üìù Completar Inscripci√≥n</h2>
    <input type="hidden" id="fila_index">

    <label for="estado">Estado:</label>
    <select id="estado">
        <option value="S√≠">S√≠</option>
        <option value="No">No</option>
    </select>

    <label for="monto">Monto:</label>
    <input type="text" id="monto" value="500">

    <label for="fecha">Fecha:</label>
    <input type="date" id="fecha">

    <button id="guardar">üíæ Guardar Inscripci√≥n</button>

    <div id="alerta" class="alert"></div>
</div>

<script>
    // Funci√≥n para buscar candidata
    document.getElementById("buscar").addEventListener("click", function() {
        const busqueda = document.getElementById("busqueda").value.trim();

        if (!busqueda) {
            alert("‚ö†Ô∏è Ingresa un nombre o c√©dula para buscar.");
            return;
        }

        fetch('/buscar_inscripcion?query=' + encodeURIComponent(busqueda))
        .then(response => response.json())
        .then(data => {
            if (data.fila_index) {
                document.getElementById("fila_index").value = data.fila_index;
                document.getElementById("codigo").textContent = data.codigo || "Se generar√° autom√°ticamente";
                document.getElementById("nombre").textContent = data.nombre || "No disponible";
                document.getElementById("cedula").textContent = data.cedula || "No disponible";
                document.getElementById("telefono").textContent = data.telefono || "No disponible";
                document.getElementById("ciudad").textContent = data.ciudad || "No disponible";
            } else {
                mostrarMensaje("‚ùå No se encontr√≥ la candidata.", "error");
            }
        })
        .catch(error => console.error("Error en la b√∫squeda:", error));
    });

    // Funci√≥n para guardar inscripci√≥n
    document.getElementById("guardar").addEventListener("click", function() {
    const filaIndex = document.getElementById("fila_index").value.trim();
    const estado = document.getElementById("estado").value.trim();
    const monto = document.getElementById("monto").value.trim();
    const fecha = document.getElementById("fecha").value.trim();

    if (!filaIndex || !estado || !monto || !fecha) {
        mostrarMensaje("‚ùå Todos los campos son obligatorios.", "error");
        return;
    }

    fetch("/procesar_inscripcion", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            fila_index: filaIndex,
            estado: estado,
            monto: monto,
            fecha: fecha
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log("üìå Respuesta del servidor:", data);
        if (data.success) {
            mostrarMensaje('‚úÖ Inscripci√≥n guardada correctamente. C√≥digo: ${data.codigo || "No asignado"}', "success");
        } else {
            let errorMessage = data.error ? data.error : "Respuesta inesperada";
            mostrarMensaje('‚ùå Error al actualizar: ${errorMessage}', "error");
        }
    })
    .catch(error => {
        console.error("Error en la solicitud:", error);
        mostrarMensaje("‚ùå Error en la solicitud. Int√©ntalo de nuevo.", "error");
    });
}); // <<--- Posiblemente falte este cierre

// Funci√≥n para mostrar mensajes en pantalla
function mostrarMensaje(mensaje, tipo) {
    let alerta = document.getElementById("alerta");
    alerta.textContent = mensaje;
    alerta.style.display = "block";
    alerta.style.color = tipo === "success" ? "green" : "red";
} // <<--- Aseg√∫rate de que esta funci√≥n est√© cerrada
</script>
<div id="alerta" style="display: none; padding: 10px; margin-top: 10px; font-weight: bold;"></div>
</body>
</html>