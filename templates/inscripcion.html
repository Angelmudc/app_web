<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscripción de Candidatas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="{{ url_for('static', filename='local-storage.js') }}"></script>
</head>
<body class="container mt-4">

    <h1 class="text-center">Inscripción de Candidatas</h1>

    {% if mensaje %}
    <div class="alert alert-warning text-center">
        {{ mensaje }}
    </div>
    {% endif %}

    <form method="POST" action="{{ url_for('inscripcion') }}" class="mb-4">
        <label for="buscar" class="form-label">Buscar candidata por cédula, nombre o teléfono:</label>
        <input type="text" name="buscar" id="buscar" class="form-control" required>
        <button type="submit" class="btn btn-primary mt-2">Buscar</button>
    </form>

    {% if datos_candidata %}
    <form method="POST" action="{{ url_for('guardar_inscripcion') }}">
        <div class="mb-3">
            <label for="codigo" class="form-label">Código</label>
            <input type="text" name="codigo" id="codigo" class="form-control" value="{{ datos_candidata.codigo or '' }}" readonly>
        </div>

        <div class="mb-3">
            <label for="nombre" class="form-label">Nombre</label>
            <input type="text" name="nombre" id="nombre" class="form-control" value="{{ datos_candidata.nombre or '' }}" readonly>
        </div>

        <div class="mb-3">
            <label for="cedula" class="form-label">Cédula</label>
            <input type="text" name="cedula" id="cedula" class="form-control" value="{{ datos_candidata.cedula or '' }}" readonly>
        </div>

        <div class="mb-3">
            <label for="telefono" class="form-label">Teléfono</label>
            <input type="text" name="telefono" id="telefono" class="form-control" value="{{ datos_candidata.telefono or '' }}" readonly>
        </div>

        <div class="mb-3">
            <label for="estado" class="form-label">Estado</label>
            <select name="estado" id="estado" class="form-select">
                <option value="Pendiente" {% if datos_candidata.estado == 'Pendiente' %}selected{% endif %}>Pendiente</option>
                <option value="Inscrita" {% if datos_candidata.estado == 'Inscrita' %}selected{% endif %}>Inscrita</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="monto" class="form-label">Monto</label>
            <input type="text" name="monto" id="monto" class="form-control" value="{{ datos_candidata.monto or '' }}">
        </div>

        <div class="mb-3">
            <label for="fecha" class="form-label">Fecha</label>
            <input type="date" name="fecha" id="fecha" class="form-control" value="{{ datos_candidata.fecha or '' }}">
        </div>

        <input type="hidden" name="fila_index" value="{{ datos_candidata.fila_index or '' }}">

        <button type="submit" class="btn btn-success">Guardar Inscripción</button>
    </form>
    {% endif %}

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let candidata = localStorage.getItem("ultima_candidata");
            if (candidata) {
                candidata = JSON.parse(candidata);

                document.querySelector("[name='codigo']").value = candidata.codigo || "";
                document.querySelector("[name='nombre']").value = candidata.nombre || "";
                document.querySelector("[name='cedula']").value = candidata.cedula || "";
                document.querySelector("[name='telefono']").value = candidata.telefono || "";
                document.querySelector("[name='estado']").value = candidata.estado || "Pendiente";
                document.querySelector("[name='monto']").value = candidata.monto || "";
                document.querySelector("[name='fecha']").value = candidata.fecha || "";
            }
        });

        document.querySelector("form[action='{{ url_for('guardar_inscripcion') }}']").addEventListener("submit", function (event) {
            let candidata = {
                codigo: document.querySelector("[name='codigo']").value,
                nombre: document.querySelector("[name='nombre']").value,
                cedula: document.querySelector("[name='cedula']").value,
                telefono: document.querySelector("[name='telefono']").value,
                estado: document.querySelector("[name='estado']").value,
                monto: document.querySelector("[name='monto']").value,
                fecha: document.querySelector("[name='fecha']").value
            };
            localStorage.setItem("ultima_candidata", JSON.stringify(candidata));
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>