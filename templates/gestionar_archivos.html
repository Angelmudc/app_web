<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestionar Archivos</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-4">
    <h1 class="text-center mb-4">Gestión de Archivos y Entrevistas</h1>

    {% if mensaje %}
      <div class="alert alert-info text-center">{{ mensaje }}</div>
    {% endif %}

    <!-- Sección de búsqueda (accion=buscar) -->
    {% if accion == "buscar" %}
      <form method="post" action="/gestionar_archivos?accion=buscar">
        <div class="input-group mb-3">
          <input type="text" class="form-control" name="busqueda" placeholder="Nombre, cédula, teléfono..." required>
          <button class="btn btn-primary" type="submit">Buscar</button>
        </div>
      </form>
      {% if resultados %}
        <h2>Resultados</h2>
        <div class="row">
          {% for cand in resultados %}
            <div class="col-md-4">
              <div class="card mb-4">
                <div class="card-body">
                  <h5 class="card-title">{{ cand.nombre }}</h5>
                  <p><strong>Teléfono:</strong> {{ cand.telefono }}<br>
                     <strong>Cédula:</strong> {{ cand.cedula }}</p>
                  <a href="/gestionar_archivos?accion=ver&fila={{ cand.fila_index }}" class="btn btn-success">
                    Ver Documentos
                  </a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endif %}

    <!-- Sección de visualización de documentos (accion=ver) -->
    {% if accion == "ver" %}
      <h2>Documentos de la fila {{ fila }}</h2>
      {% if docs %}
        <ul>
          <li><strong>Depuración:</strong> 
            {% if docs.depuracion_url %}
              <a href="/gestionar_archivos?accion=descargar&doc=depuracion&fila={{ fila }}">
                Descargar Depuración
              </a> ({{ docs.depuracion_url }})
            {% else %}
              No disponible
            {% endif %}
          </li>
          <li><strong>Perfil:</strong> 
            {% if docs.perfil_url %}
              <a href="/gestionar_archivos?accion=descargar&doc=perfil&fila={{ fila }}">
                Descargar Perfil
              </a> ({{ docs.perfil_url }})
            {% else %}
              No disponible
            {% endif %}
          </li>
          <li><strong>Cédula 1:</strong>
            {% if docs.cedula1_url %}
              <a href="/gestionar_archivos?accion=descargar&doc=cedula1&fila={{ fila }}">
                Descargar Cédula1
              </a> ({{ docs.cedula1_url }})
            {% else %}
              No disponible
            {% endif %}
          </li>
          <li><strong>Cédula 2:</strong>
            {% if docs.cedula2_url %}
              <a href="/gestionar_archivos?accion=descargar&doc=cedula2&fila={{ fila }}">
                Descargar Cédula2
              </a> ({{ docs.cedula2_url }})
            {% else %}
              No disponible
            {% endif %}
          </li>
          <li><strong>Entrevista (columna Z):</strong>
            {% if docs.entrevista %}
              <a href="/gestionar_archivos?accion=descargar&doc=pdf&fila={{ fila }}">
                Generar/Descargar PDF
              </a>
            {% else %}
              No disponible
            {% endif %}
          </li>
        </ul>
        <!-- Botón para descargar todo en un ZIP -->
        <a href="/gestionar_archivos?accion=descargar&doc=todo&fila={{ fila }}" class="btn btn-primary">
          Descargar TODO (ZIP)
        </a>
      {% else %}
        <p>No se encontraron documentos en las columnas AA-AD.</p>
      {% endif %}
    {% endif %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
