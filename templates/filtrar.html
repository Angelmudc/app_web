{# templates/filtrar.html #}
{% extends 'base.html' %}

{% block title %}Filtrar Candidatas{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-4">üîç Filtrar Candidatas</h2>

  {# Mensaje de alerta #}
  {% if mensaje %}
    <div class="alert alert-warning">{{ mensaje }}</div>
  {% endif %}

  {# Formulario de filtros #}
  <form method="POST" action="{{ url_for('filtrar') }}" class="mb-5">
    <div class="row g-3">
      <div class="col-md-6">
        <label for="ciudad" class="form-label">Ciudad / Direcci√≥n</label>
        <input
          type="text"
          class="form-control"
          id="ciudad" name="ciudad"
          placeholder="Ingresa ciudad o parte de la direcci√≥n"
          value="{{ request.values.get('ciudad','') }}"
        >
      </div>
      <div class="col-md-6">
        <label for="rutas" class="form-label">Rutas Cercanas</label>
        <input
          type="text"
          class="form-control"
          id="rutas" name="rutas"
          placeholder="Ingresa rutas cercanas"
          value="{{ request.values.get('rutas','') }}"
        >
      </div>
      <div class="col-md-6">
        <label for="modalidad" class="form-label">Modalidad de trabajo</label>
        <select class="form-select" id="modalidad" name="modalidad">
          <option value="" {% if not request.values.get('modalidad') %}selected{% endif %}>(Sin filtro)</option>
          <option value="salida diaria" {% if request.values.get('modalidad')=='salida diaria' %}selected{% endif %}>Salida diaria</option>
          <option value="dormida"       {% if request.values.get('modalidad')=='dormida'       %}selected{% endif %}>Dormida</option>
        </select>
      </div>
      <div class="col-md-6">
        <label for="experiencia_anos" class="form-label">A√±os de experiencia</label>
        <select class="form-select" id="experiencia_anos" name="experiencia_anos">
          <option value="" {% if not request.values.get('experiencia_anos') %}selected{% endif %}>(Sin filtro)</option>
          <option value="1 a√±o"           {% if request.values.get('experiencia_anos')=='1 a√±o'           %}selected{% endif %}>1 a√±o</option>
          <option value="2 a√±os"          {% if request.values.get('experiencia_anos')=='2 a√±os'          %}selected{% endif %}>2 a√±os</option>
          <option value="3 a√±os o m√°s"    {% if request.values.get('experiencia_anos')=='3 a√±os o m√°s'    %}selected{% endif %}>3 a√±os o m√°s</option>
          <option value="sin experiencia" {% if request.values.get('experiencia_anos')=='sin experiencia' %}selected{% endif %}>Sin experiencia</option>
        </select>
      </div>
      <div class="col-12">
        <label for="areas_experiencia" class="form-label">√Åreas de experiencia</label>
        <select class="form-select" id="areas_experiencia" name="areas_experiencia">
          <option value="" {% if not request.values.get('areas_experiencia') %}selected{% endif %}>(Sin filtro)</option>
          <option value="limpieza"             {% if request.values.get('areas_experiencia')=='limpieza'              %}selected{% endif %}>Limpieza</option>
          <option value="cocinera"             {% if request.values.get('areas_experiencia')=='cocinera'              %}selected{% endif %}>Cocinera</option>
          <option value="ni√±era"               {% if request.values.get('areas_experiencia')=='ni√±era'                %}selected{% endif %}>Ni√±era</option>
          <option value="cuidar envejeciente"  {% if request.values.get('areas_experiencia')=='cuidar envejeciente'   %}selected{% endif %}>Cuidar envejeciente</option>
          <option value="todas las anteriores" {% if request.values.get('areas_experiencia')=='todas las anteriores'  %}selected{% endif %}>Todas las anteriores</option>
          <option value="enfermeria"           {% if request.values.get('areas_experiencia')=='enfermeria'            %}selected{% endif %}>Enfermer√≠a</option>
        </select>
      </div>
      <div class="col-12 text-end">
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-filter"></i> Aplicar filtros
        </button>
      </div>
    </div>
  </form>

  {# Resultados #}
  {% if resultados %}
    <h5>Resultados ({{ resultados|length }})</h5>
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-dark">
          <tr>
            <th>Nombre</th>
            <th>C√≥digo</th>
            <th>Tel√©fono</th>
            <th>Direcci√≥n</th>
            <th>Rutas</th>
            <th>C√©dula</th>
            <th>Modalidad</th>
            <th>Experiencia</th>
            <th>√Åreas</th>
          </tr>
        </thead>
        <tbody>
          {% for c in resultados %}
            <tr>
              <td>{{ c.nombre }}</td>
              <td>{{ c.codigo }}</td>
              <td>{{ c.telefono }}</td>
              <td>{{ c.direccion }}</td>
              <td>{{ c.rutas or '‚Äî' }}</td>
              <td>{{ c.cedula }}</td>
              <td>{{ c.modalidad }}</td>
              <td>{{ c.experiencia_anos }}</td>
              <td>{{ c.areas_experiencia }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    {% if not mensaje %}
      <div class="alert alert-info">No se encontraron candidatas con los filtros aplicados.</div>
    {% endif %}
  {% endif %}

  <a href="{{ url_for('home') }}" class="btn btn-outline-secondary mt-4">
    <i class="fas fa-home"></i> Volver al Inicio
  </a>
</div>
{% endblock %}
